# CFiler

CUI ベースの 2 ペインファイラー。Go + [Bubble Tea](https://github.com/charmbracelet/bubbletea) で構築されたキーボード駆動のファイルマネージャーです。

```
╭─ E:\Projects ─────────╮╭─ E:\Backup ───────────╮
│ ..                     ││ ..                     │
│ src/          <DIR>    ││ 2025-01/      <DIR>    │
│ docs/         <DIR>    ││ 2025-02/      <DIR>    │
│ main.go       1.2K     ││ archive.zip   48.3M    │
│ go.mod         512B    ││ notes.txt      3.1K    │
╰────────────────────────╯╰────────────────────────╯
 E:\Projects | -rwxr-xr-x | 1234 bytes
```

## 特徴

- **2 ペインレイアウト** — 左右独立したディレクトリ一覧でファイル操作が直感的
- **ファイルプレビュー** — テキストファイルの内容をプレビューパネルで表示 (`t` で切替)
- **ファイル操作** — コピー・移動・削除・リネーム・ディレクトリ作成
- **インクリメンタル検索** — `/` でファイル名をリアルタイム絞り込み
- **ブックマーク** — よく使うディレクトリを保存・呼び出し
- **クロスプラットフォーム** — Windows / macOS / Linux 対応

## 必要環境

- Go 1.21 以上

## インストール

```bash
git clone <repository-url>
cd CFiler
go build -o cfiler.exe .
```

macOS / Linux の場合:

```bash
go build -o cfiler .
```

## 使い方

```bash
./cfiler
```

起動するとカレントディレクトリが左右両ペインに表示されます。アプリ内で `?` を押すとヘルプ画面を表示できます。

## キーバインド

### ナビゲーション

| キー | 操作 |
|------|------|
| `↑` / `↓` | カーソル移動 |
| `Enter` | ディレクトリに入る |
| `Backspace` | 親ディレクトリへ |
| `Tab` | 左右ペイン切替 |
| `PageUp` / `PageDown` | ページスクロール |
| `Home` / `End` | 先頭 / 末尾へ移動 |

### ファイル操作

| キー | 操作 |
|------|------|
| `F5` / `c` | コピー (クリップボードに格納) |
| `F6` / `m` | 移動 (クリップボードに格納) |
| `p` | 貼り付け (もう一方のペインへ) |
| `F7` / `n` | 新規ディレクトリ作成 |
| `F8` / `d` | 削除 (確認ダイアログ付き) |
| `r` | リネーム |

コピー・移動の操作手順:

1. コピー元ペインで対象ファイルにカーソルを合わせる
2. `c` (コピー) または `m` (移動) でクリップボードに格納
3. `Tab` でもう一方のペインに切替
4. `p` で貼り付け実行

### 検索

| キー | 操作 |
|------|------|
| `/` | インクリメンタル検索を開始 |
| (文字入力) | リアルタイムでフィルタリング (大文字小文字無視) |
| `Enter` | 検索結果を確定 |
| `Esc` | 検索をキャンセル |

### ブックマーク

| キー | 操作 |
|------|------|
| `B` | 現在のディレクトリをブックマークに追加 |
| `b` | ブックマーク一覧を表示 |
| `Enter` | 選択したブックマークへ移動 (一覧内) |
| `d` | ブックマークを削除 (一覧内) |
| `Esc` | ブックマーク一覧を閉じる |

ブックマークは JSON 形式で永続化されます。

- Windows: `%APPDATA%\cfiler\bookmarks.json`
- macOS: `~/Library/Application Support/cfiler/bookmarks.json`
- Linux: `~/.config/cfiler/bookmarks.json`

### 表示

| キー | 操作 |
|------|------|
| `t` | プレビューパネルの表示 / 非表示を切替 |
| `?` | ヘルプ画面を表示 |

プレビューパネル表示時のレイアウト比率:

```
[左ペイン 35%] [右ペイン 35%] [プレビュー 30%]
```

### その他

| キー | 操作 |
|------|------|
| `Esc` | ダイアログ / 検索 / ブックマーク画面を閉じる |
| `q` / `Ctrl+C` | 終了 |

## プロジェクト構成

```
CFiler/
├── main.go                      # エントリポイント
└── internal/
    ├── app/
    │   ├── app.go               # ルートモデル (全サブモデルの統合)
    │   ├── keys.go              # キーバインド定義
    │   ├── messages.go          # カスタムメッセージ型
    │   └── styles.go            # lipgloss スタイル定義
    ├── pane/
    │   ├── pane.go              # ペインモデル (カーソル・スクロール・検索)
    │   ├── pane_view.go         # ペインの描画
    │   └── entry.go             # FileEntry 構造体
    ├── preview/
    │   └── preview.go           # ファイルプレビュー (viewport)
    ├── statusbar/
    │   └── statusbar.go         # ステータスバー
    ├── dialog/
    │   ├── dialog.go            # Dialog インターフェース
    │   ├── confirm.go           # 確認ダイアログ (Y/n)
    │   └── input.go             # テキスト入力ダイアログ
    ├── bookmark/
    │   ├── bookmark.go          # ブックマーク一覧モデル
    │   └── store.go             # ブックマーク永続化 (JSON)
    ├── fileops/
    │   └── ops.go               # ファイル操作 (コピー・移動・削除・リネーム・mkdir)
    └── config/
        └── config.go            # 設定ディレクトリのパス解決
```

## アーキテクチャ

Bubble Tea の Elm アーキテクチャ (Model → Update → View) に従っています。

- **ルートモデル (`app.App`)** — 左右ペイン・プレビュー・ステータスバー等のサブモデルを保持し、`mode` (Normal / Dialog / Search / Bookmark / Help) でキー入力の振り分けを制御
- **ファイル I/O** — 全て `tea.Cmd` で非同期実行し、結果をメッセージで受信
- **ダイアログ** — `lipgloss.Place()` によるオーバーレイ表示

## ライセンス

MIT
